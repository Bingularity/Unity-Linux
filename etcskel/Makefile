NAME = etcskel
VERSION=$(shell rpm -q --specfile --qf %{VERSION} $(NAME).spec)
LIST = bash_logout bash_profile config
RPMSOURCEDIR = $(shell rpm --eval %_sourcedir)

all: 
	@echo "Do a make install"	

install:
	install -d $(RPM_BUILD_ROOT)/etc/skel	
	for i in $(LIST); do cp -avf $$i $(RPM_BUILD_ROOT)/etc/skel/.$$i ; done
	cp -avf Desktop $(RPM_BUILD_ROOT)/etc/skel/
	install -d -m750 $(RPM_BUILD_ROOT)/etc/skel/tmp

dis: 
	rm -rf $(NAME)-$(VERSION) ../$(NAME)-$(VERSION).tar*
	mkdir -p $(NAME)-$(VERSION)
	find . -not -name "$(NAME)-$(VERSION)"|cpio -pd $(NAME)-$(VERSION)/
	find $(NAME)-$(VERSION) -type d -name CVS -o -name .cvsignore -o -name unused -o -name .dummy |xargs rm -rf
	tar cJf ../$(NAME)-$(VERSION).tar.xz $(NAME)-$(VERSION)
	rm -rf $(NAME)-$(VERSION)

changelog: ../common/username
	cvs2cl -U ../common/username -I ChangeLog 
	rm -f ChangeLog.bak
	cvs commit -m "Generated by cvs2cl the `date '+%d_%b'`" ChangeLog

rpm: dis ../$(NAME)-$(VERSION).tar.bz2 $(RPM)
	cp -f ../$(NAME)-$(VERSION).tar.bz2 $(RPMSOURCEDIR)
	-rpm -ba --clean --rmsource $(NAME).spec
	rm -f ../$(NAME)-$(VERSION).tar.bz2
